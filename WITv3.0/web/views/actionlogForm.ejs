<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Action Log Settings</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #1e293b; color: #e2e8f0; margin: 0; padding: 2rem; }
        .container { max-width: 900px; margin: 0 auto; padding: 2.5rem; border-radius: 0.75rem; background-color: #334155; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); border: 1px solid #475569; }
        h1, h2 { color: #f8fafc; text-align: center; }
        h1 { font-size: 1.875rem; font-weight: 600; margin-bottom: 2rem; }
        h2 { font-size: 1.25rem; font-weight: 500; margin-top: 2.5rem; margin-bottom: 1.5rem; border-bottom: 1px solid #475569; padding-bottom: 0.75rem; text-align: left;}
        form { display: flex; flex-direction: column; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; }
        .checkbox-group { display: flex; align-items: center; gap: 0.75rem; background-color: #475569; padding: 0.75rem; border-radius: 0.5rem; }
        input[type="checkbox"] { width: 1.25rem; height: 1.25rem; cursor: pointer; }
        label { font-weight: 500; color: #cbd5e1; cursor: pointer; }
        .select-group { display: flex; flex-direction: column; gap: 0.5rem; }
        select { width: 100%; padding: 0.75rem; border-radius: 0.375rem; background-color: #1e293b; border: 1px solid #475569; color: #e2e8f0; font-size: 1rem; }
        select:focus { outline: none; border-color: #38bdf8; }
        .actions { margin-top: 2.5rem; }
        button { width: 100%; padding: 0.75rem 1.5rem; border: none; border-radius: 0.375rem; background-color: #22c55e; color: #ffffff; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #16a34a; }
        .tag-container { display: flex; flex-wrap: wrap; gap: 0.5rem; padding: 0.5rem; background-color: #1e293b; border-radius: 0.375rem; min-height: 40px; border: 1px solid #475569; margin-top: 0.5rem;}
        .tag { display: flex; align-items: center; background-color: #4f46e5; color: white; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; }
        .tag-remove { margin-left: 0.5rem; background: none; border: none; color: white; cursor: pointer; font-weight: bold; font-size: 1rem; padding: 0; line-height: 1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Action Log Settings</h1>
        <form id="settings-form" action="/actionlog/<%= token %>" method="POST">
            
            <h2>Message Events</h2>
            <div class="grid">
                <div class="checkbox-group">
                    <input type="checkbox" id="log_message_delete" name="log_message_delete" <%= settings.log_message_delete ? 'checked' : '' %>>
                    <label for="log_message_delete">Message Delete</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_message_edit" name="log_message_edit" <%= settings.log_message_edit ? 'checked' : '' %>>
                    <label for="log_message_edit">Message Edit</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_image_delete" name="log_image_delete" <%= settings.log_image_delete ? 'checked' : '' %>>
                    <label for="log_image_delete">Image Delete</label>
                </div>
            </div>

            <h2>Member Events</h2>
            <div class="grid">
                <div class="checkbox-group">
                    <input type="checkbox" id="log_member_join" name="log_member_join" <%= settings.log_member_join ? 'checked' : '' %>>
                    <label for="log_member_join">Member Join</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_member_leave" name="log_member_leave" <%= settings.log_member_leave ? 'checked' : '' %>>
                    <label for="log_member_leave">Member Leave</label>
                </div>
                 <div class="checkbox-group">
                    <input type="checkbox" id="log_member_role_update" name="log_member_role_update" <%= settings.log_member_role_update ? 'checked' : '' %>>
                    <label for="log_member_role_update">Member Role Update</label>
                </div>
                 <div class="checkbox-group">
                    <input type="checkbox" id="log_nickname_change" name="log_nickname_change" <%= settings.log_nickname_change ? 'checked' : '' %>>
                    <label for="log_nickname_change">Nickname Change</label>
                </div>
            </div>
            
            <h2>Voice Events</h2>
            <div class="grid">
                <div class="checkbox-group">
                    <input type="checkbox" id="log_voice_join" name="log_voice_join" <%= settings.log_voice_join ? 'checked' : '' %>>
                    <label for="log_voice_join">Voice Join</label>
                </div>
                 <div class="checkbox-group">
                    <input type="checkbox" id="log_voice_leave" name="log_voice_leave" <%= settings.log_voice_leave ? 'checked' : '' %>>
                    <label for="log_voice_leave">Voice Leave</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_voice_move" name="log_voice_move" <%= settings.log_voice_move ? 'checked' : '' %>>
                    <label for="log_voice_move">Voice Move</label>
                </div>
            </div>

            <h2>Moderation Events</h2>
            <div class="grid">
                <div class="checkbox-group">
                    <input type="checkbox" id="log_member_ban" name="log_member_ban" <%= settings.log_member_ban ? 'checked' : '' %>>
                    <label for="log_member_ban">Member Ban</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_member_unban" name="log_member_unban" <%= settings.log_member_unban ? 'checked' : '' %>>
                    <label for="log_member_unban">Member Unban</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_member_timeout" name="log_member_timeout" <%= settings.log_member_timeout ? 'checked' : '' %>>
                    <label for="log_member_timeout">Member Timeout</label>
                </div>
            </div>

            <h2>Role & Channel Events</h2>
            <div class="grid">
                <div class="checkbox-group">
                    <input type="checkbox" id="log_role_create" name="log_role_create" <%= settings.log_role_create ? 'checked' : '' %>>
                    <label for="log_role_create">Role Create</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_role_delete" name="log_role_delete" <%= settings.log_role_delete ? 'checked' : '' %>>
                    <label for="log_role_delete">Role Delete</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_role_update" name="log_role_update" <%= settings.log_role_update ? 'checked' : '' %>>
                    <label for="log_role_update">Role Update</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_channel_create" name="log_channel_create" <%= settings.log_channel_create ? 'checked' : '' %>>
                    <label for="log_channel_create">Channel Create</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_channel_delete" name="log_channel_delete" <%= settings.log_channel_delete ? 'checked' : '' %>>
                    <label for="log_channel_delete">Channel Delete</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_channel_update" name="log_channel_update" <%= settings.log_channel_update ? 'checked' : '' %>>
                    <label for="log_channel_update">Channel Update</label>
                </div>
            </div>

            <h2>Invite Events</h2>
            <div class="grid">
                <div class="checkbox-group">
                    <input type="checkbox" id="log_invite_create" name="log_invite_create" <%= settings.log_invite_create ? 'checked' : '' %>>
                    <label for="log_invite_create">Invite Create</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="log_invite_delete" name="log_invite_delete" <%= settings.log_invite_delete ? 'checked' : '' %>>
                    <label for="log_invite_delete">Invite Delete</label>
                </div>
            </div>

            <h2>Ignored Channels</h2>
            <div class="select-group">
                <label for="channel-select">Select a channel to add it to the ignore list.</label>
                <select id="channel-select">
                    <option value="" disabled selected>Select a channel...</option>
                    <% channels.forEach(channel => { %>
                        <option value="<%= channel.id %>" data-name="#<%= channel.name %>"><%= channel.name %></option>
                    <% }); %>
                </select>
                <div id="ignored-channels-container" class="tag-container"></div>
            </div>
            
            <h2>Ignored Roles</h2>
            <div class="select-group">
                 <label for="role-select">Select a role to add it to the ignore list.</label>
                <select id="role-select">
                    <option value="" disabled selected>Select a role...</option>
                     <% roles.forEach(role => { %>
                        <option value="<%= role.id %>" data-name="@<%= role.name %>"><%= role.name %></option>
                    <% }); %>
                </select>
                <div id="ignored-roles-container" class="tag-container"></div>
            </div>

            <div class="actions">
                <button type="submit">Save Settings</button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('settings-form');
            function setupTagSelector(selectId, containerId, initialIds, allItems, inputName, namePrefix) {
                const selectElement = document.getElementById(selectId);
                const container = document.getElementById(containerId);
                function addTag(id, name) {
                    if (document.querySelector(`input[name="${inputName}"][value="${id}"]`)) {
                        return; 
                    }
                    const tag = document.createElement('div');
                    tag.className = 'tag';
                    tag.textContent = name;
                    const hiddenInput = document.createElement('input');
                    hiddenInput.type = 'hidden';
                    hiddenInput.name = inputName;
                    hiddenInput.value = id;
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'tag-remove';
                    removeBtn.innerHTML = '&times;';
                    removeBtn.type = 'button';
                    removeBtn.onclick = () => {
                        tag.remove();
                        hiddenInput.remove();
                    };
                    tag.appendChild(removeBtn);
                    container.appendChild(tag);
                    form.appendChild(hiddenInput);
                }
                selectElement.addEventListener('change', (e) => {
                    const selectedOption = e.target.options[e.target.selectedIndex];
                    if (selectedOption.value) {
                        addTag(selectedOption.value, selectedOption.dataset.name);
                        e.target.selectedIndex = 0;
                    }
                });
                initialIds.forEach(id => {
                    const item = allItems.find(i => i.id === id);
                    if (item) {
                        addTag(id, `${namePrefix}${item.name}`);
                    }
                });
            }
            setupTagSelector('channel-select', 'ignored-channels-container', <%- JSON.stringify(settings.ignored_channels) %>, <%- JSON.stringify(channels) %>, 'ignored_channels', '#');
            setupTagSelector('role-select', 'ignored-roles-container', <%- JSON.stringify(settings.ignored_roles) %>, <%- JSON.stringify(roles) %>, 'ignored_roles', '@');
        });
    </script>
</body>
</html>

